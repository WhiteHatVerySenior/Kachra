<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Color Sort Sprint</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;600;700&family=Space+Mono:wght@400;700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <main class="stage">
      <!-- Added new info page. 0.5.0 -->
      <!-- Version 0.1.0 was first basic idea -->
      <!-- Version 0.2.0 was test and practice mode -->
      <!-- Version 0.3.0 was memes mode and extended items list -->
      <!-- Version 0.4.0 was database and feedback from initial 4 people -->
      <!-- Version 0.5.0 started with adding new page, geeks corner -->
      <!-- Added new pratice part called Levels. -->
      <!-- Level 1 Wet and Dry -->
      <!-- Level 2 Dry and Hazard -->
      <!-- Level 3 Dry and Reject -->
      <header class="hud">
        <div class="title">
          <span class="kicker">Prototype 0.5.1 ‚Äî LEVELS</span>
          <h1>Civic Sense: Chapter 1</h1>
          <p>Match each item to the correct bin. Misses ruins the entire batch of garbage collected.</p>
          <div class="quick-start">
            <button id="quickPractice" class="solid">60 Sec Practice</button>
            <button id="quickLevelPractice" class="ghost">Level by Level Practice</button>
          </div>
        </div>
        <div class="scoreboard">
          <div class="stat">
            <span class="label">Score</span>
            <span id="score" class="value">0</span>
          </div>
          <div class="stat">
            <span class="label">Streak</span>
            <span id="streak" class="value">0</span>
          </div>
          <div class="stat">
            <span class="label">Round</span>
            <span id="round" class="value">1</span>
          </div>
          <div class="stat" id="timeStat">
            <span class="label">Time</span>
            <span id="timeLeft" class="value">60</span>
          </div>
          <div class="stat">
            <span class="label">High</span>
            <span id="highScore" class="value">0</span>
          </div>
        </div>
        <div class="history">
          <span class="label">Recent Scores</span>
          <ul id="historyList" class="history-list"></ul>
        </div>
      </header>

      <div class="top-links">
        <a id="scoresLink" class="ghost link-button" href="scores.html">Scores</a>
        <a id="geeksLink" class="ghost link-button" href="geeks.html">Geeks Corner</a>
      </div>

      <section class="arena">
        <div class="item-card" id="itemCard">
          <div class="item-orb" id="itemOrb"></div>
          <span id="itemTimer" class="item-timer">60s</span>
          <div class="item-meta">
            <span class="item-label">ITEM</span>
            <span id="itemColor" class="item-color">BANANA PEEL</span>
            <span id="itemCounter" class="item-counter">1 / 1</span>
            <div id="practiceScoreRow" class="practice-score-row">
              <span id="practiceScoreNow" class="practice-score">Score: 0</span>
              <span id="practiceScoreHigh" class="practice-score">High: 0</span>
            </div>
            <div id="levelLives" class="level-lives">Lives: 3</div>
          </div>
        </div>

        <div class="boxes">
          <button
            class="box green"
            data-color="wet"
            data-tooltip-test="Organic"
            data-tooltip-practice="Food and biodegradable waste that can compost."
          >
            <span class="bin-emoji">üóëÔ∏è</span>
            <span class="bin-label">WET</span>
            <span class="bin-score">0</span>
            <span class="fill-overlay"></span>
            <span class="trash-stack" aria-hidden="true"></span>
            <span class="fill-bar" aria-hidden="true"></span>
          </button>
          <button
            class="box blue"
            data-color="dry"
            data-tooltip-test="Recyclable"
            data-tooltip-practice="Clean, recyclable paper, plastic, metal, glass."
          >
            <span class="bin-emoji">üóëÔ∏è</span>
            <span class="bin-label">DRY</span>
            <span class="bin-score">0</span>
            <span class="fill-overlay"></span>
            <span class="trash-stack" aria-hidden="true"></span>
            <span class="fill-bar" aria-hidden="true"></span>
          </button>
          <button
            class="box red"
            data-color="hazard"
            data-tooltip-test="Toxic"
            data-tooltip-practice="Sanitary or hazardous items that need safe handling."
          >
            <span class="bin-emoji">üóëÔ∏è</span>
            <span class="bin-label">HAZARD</span>
            <span class="bin-score">0</span>
            <span class="fill-overlay"></span>
            <span class="trash-stack" aria-hidden="true"></span>
            <span class="fill-bar" aria-hidden="true"></span>
          </button>
          <button
            class="box black"
            data-color="reject"
            data-tooltip-test="Landfill"
            data-tooltip-practice="Non-recyclable, contaminated dry waste."
          >
            <span class="bin-emoji">üóëÔ∏è</span>
            <span class="bin-label">REJECT</span>
            <span class="bin-score">0</span>
            <span class="fill-overlay"></span>
            <span class="trash-stack" aria-hidden="true"></span>
            <span class="fill-bar" aria-hidden="true"></span>
          </button>
          <button
            class="box ewaste"
            data-color="ewaste"
            data-tooltip-test="Electronics"
            data-tooltip-practice="Electronics, batteries, chargers, bulbs for special collection."
          >
            <span class="bin-emoji">‚ö°</span>
            <span class="bin-label">E-WASTE</span>
            <span class="bin-score">0</span>
            <span class="fill-overlay"></span>
            <span class="trash-stack" aria-hidden="true"></span>
            <span class="fill-bar" aria-hidden="true"></span>
          </button>
        </div>
      </section>

      <footer class="controls">
        <button id="shuffle" class="ghost">New Item</button>
        <button id="styleToggle" class="ghost">Fill Style</button>
        <button id="changeProfile" class="ghost">Change Profile</button>
        <button id="backToTest" class="ghost">Back to Score Test</button>
        <button id="memeMode" class="ghost">Meme Mode: Off</button>
        <button id="reset" class="solid">Reset</button>
      </footer>

      <div id="toast" class="toast" aria-live="polite"></div>
    </main>

    <div id="profileModal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="profileTitle">
      <div class="modal-card">
        <div class="welcome-hero">
          WELCOME TO CHAPTER 1 of CIVIC SENSE COURSE FOR INDIA
        </div>
        <h2 id="profileTitle">Player Profile</h2>
        <p class="modal-sub">
          This data is IMPORTANT for me to understand how the prototype is working
          <br />
          BINA NATAK KARE PURA GAME KHEL!!!
        </p>
        <form id="profileForm">
          <label class="field">
            <span>Name</span>
            <input id="playerName" type="text" required placeholder="Your name" />
          </label>
          <label class="field">
            <span>Age Group</span>
            <select id="playerAge" required>
              <option value="" disabled selected>Select</option>
              <option value="0-10">0-10</option>
              <option value="10-15">10-15</option>
              <option value="15-20">15-20</option>
              <option value="20-25">20-25</option>
              <option value="25-30">25-30</option>
              <option value="30-35">30-35</option>
              <option value="35-40">35-40</option>
              <option value="40-45">40-45</option>
              <option value="45-50">45-50</option>
              <option value="50-55">50-55</option>
              <option value="55-60">55-60</option>
              <option value="60-65">60-65</option>
              <option value="65-70">65-70</option>
              <option value="70-75">70-75</option>
              <option value="75-80">75-80</option>
              <option value="80-85">80-85</option>
              <option value="85-90">85-90</option>
              <option value="90-95">90-95</option>
              <option value="95-100">95-100</option>
            </select>
          </label>
          <button type="submit" class="solid wide">Start</button>
        </form>
      </div>
    </div>

    <div id="endModal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="endTitle">
      <div class="modal-card">
        <h2 id="endTitle">Civic Sense Score</h2>
        <p id="testResultLine" class="modal-sub">Great effort! Your score:</p>
        <div id="civicScore" class="score-big">0</div>
        <button id="shareScore" class="ghost wide">Share your score with others</button>
        <p id="civicNote" class="score-note">
          desh ka Zero Civic Sense dikhta hai or khud ka nahi? Every wrong item thrown in wrong basket ruins the entire batch
        </p>
        <p id="saveStatusTest" class="save-status"></p>
        <div class="test-actions">
          <button id="startPractice" class="solid wide">60 Sec Practice</button>
          <button id="startLevelPractice" class="ghost wide">Level by Level Practice</button>
        </div>
      </div>
    </div>

    <div id="practiceEndModal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="practiceEndTitle">
      <div class="modal-card">
        <h2 id="practiceEndTitle">Practice Result</h2>
        <div id="practiceScore" class="score-big">0</div>
        <div class="gandhi">üßπ</div>
        <p id="learningPoint" class="learning-point"></p>
        <p class="modal-sub">
          or practice kar, itne me kaam nahi chalega and the top score wins a prize
        </p>
        <p id="saveStatusPractice" class="save-status"></p>
        <button id="practiceAgain" class="solid wide">Play Again</button>
      </div>
    </div>

    <!-- Added DataBase FireStore -->
    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
      import {
        getFirestore,
        collection,
        addDoc,
        serverTimestamp,
        query,
        where,
        orderBy,
        limit,
        getDocs,
      } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-firestore.js";

      const firebaseConfig = {
        apiKey: "AIzaSyDlktCZaQxZ1tL4dJKnGwDkJgTHAVdPfHA",
        authDomain: "civicsense-8a9db.firebaseapp.com",
        projectId: "civicsense-8a9db",
        storageBucket: "civicsense-8a9db.firebasestorage.app",
        messagingSenderId: "61969210324",
        appId: "1:61969210324:web:2bf88195f619d05c1a9441",
        measurementId: "G-79PBVLLNP7",
      };

      const app = initializeApp(firebaseConfig);
      const db = getFirestore(app);

      window.firebaseAddScore = async (payload) => {
        await addDoc(collection(db, "scores"), {
          ...payload,
          createdAt: serverTimestamp(),
        });
      };

      window.firebaseGetPracticeHigh = async () => {
        const q = query(
          collection(db, "scores"),
          where("mode", "==", "practice"),
          orderBy("score", "desc"),
          limit(1)
        );
        const snap = await getDocs(q);
        if (snap.empty) return 0;
        const data = snap.docs[0].data();
        return typeof data.score === "number" ? data.score : Number(data.score || 0);
      };
    </script>

    <script src="script.js"></script>
  </body>
</html>
